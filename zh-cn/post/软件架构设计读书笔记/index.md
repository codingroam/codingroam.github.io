# 软件架构设计读书笔记


根据软件架构设计：大型网站技术架构与业务架构融合之道一书所作的读书笔记

<!--more-->





### 1. 架构分层

1. 第一层：基础架构

   指云平台、操作系统、网络、存储、数据库等

2. 第二层：中间件与大数据平台
   1. 中间件：如分布式服务中间件，消息中间件、数据库中间件、缓存中间件、监控中间件、工作流或者规则引擎等
   2. 大数据架构：Hadoop生态体系，hive,Spark,Storm,Flink等

3. 第三层：业务系统架构
   1. 通用软件系统，常用的办公软件、浏览器、播放器等
   2. 离线业务系统，如各种基于大数据的BI分析，数据挖掘，报表与可视化。
   3. 大型在线业务系统，如搜索，推荐，即时通信，电商，游戏，广告，企业ERP等

架构的道与术：解决一系列问题的方法论即为道，具体到某种语言技术，某个中间件的使用即为术。道是知行合一中的知，是理论，套路，方法论。术是行，是实践操作，用于解决一个个实际问题

### 2. 计算机功底

1. WAL即 Write Ahead Log，WAL的主要意思是说在将元数据的变更操作写入磁盘之前，先预先写入到一个log文件中，增加IO速度。磁盘顺序读写速度可媲美内存速度。
2. Checksum：总和检验码，校验和。在数据处理和数据通信领域中，用于校验目的的一组数据项的和。这些数据项可以是数字或在计算检验总和过程中看作数字的其它字符串，可以保证数据的完整性和正确性
3. TCP如何把不可靠变成可靠，mvcc解决并发多版本一致性等

计算机思维举例，可以借鉴



### 3. 操作系统

1. 缓冲IO与直接IO

   缓冲IO是C语言提供的函数库，以f打头，如fopen,fclose,fseek,fread,fwrite，直接IO是Linux系统的API,如open,read，write等

   对于缓冲IO,读写都是三次拷贝

   读：磁盘→内核缓冲区→用户缓冲区→应用程序内存

   写：应用程序内存→用户缓冲区→内核缓冲区→磁盘

   对于直接IO,读写都是两次数据拷贝

   读：磁盘→内核缓冲区→应用程序内存

   写：应用程序内存→内核缓冲区→磁盘

   所以，直接IO没有用户缓冲区

   1. 应用层序内存：通常是代码用malloc/free、new/delete等分配出来的内存

   2. 用户缓冲区：C语言的FILE结构体中的buffer

   3. 内核缓冲区：Linux操作系统的Page Cahce。为了加快磁盘IO，Linux会把磁盘上的数据以page为单位加载到内存中，page是一个逻辑概念，一般一个page为4K

      >缓冲IO与直接IO有几点需要贴别说明：
      >
      >1. fflush和fsync的区别。fflush是缓冲IO的一个api，作用是把数据从用户缓存刷到内核缓存，fsync是把数据从内核缓存刷到磁盘，所以无论是直接IO还是缓冲IO在写数据之后不调用fsync,此时断电的话会造成数据丢失。
      >2. 对于直接IO也有read/write和pread/pwrite两组api，后者在多线程读写同一个文件时效率更高
      >
      >

2. 内存映射与零拷贝

   相较于直接IO,内存映射文件更进一步，其实现是用应用程序的逻辑内存与Linux操作系统的内核缓存区映射，相当于与内核共用内存，数据拷贝只需一次即

   磁盘$\Leftrightarrow$内核缓冲区





---

> 作者: wang  
> URL: https://codingroam.github.io/zh-cn/post/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/  

